import { Dispatcher } from './dispatcher.js';
import { createGuid } from '../utils/crypto.js';

class JsonPipeDispatcher extends Dispatcher {
  constructor(scope) {
    super(scope, { guid: "jsonPipe@" + createGuid() }, "JsonPipe", {});
    this._type_JsonPipe = true;
  }
  async send(params) {
    this.emit("message", params.message);
  }
  async close() {
    this.emit("close");
    if (!this._disposed) {
      this._dispatchEvent("closed", {});
      this._dispose();
    }
  }
  dispatch(message) {
    if (!this._disposed)
      this._dispatchEvent("message", { message });
  }
  wasClosed(reason) {
    if (!this._disposed) {
      this._dispatchEvent("closed", { reason });
      this._dispose();
    }
  }
  dispose() {
    this._dispose();
  }
}

export { JsonPipeDispatcher };
