import { McpAgent } from 'agents/mcp';
import { endpointURLString } from '@cloudflare/playwright';
import { createServer } from './src/index.js';

function createMcpAgent(endpoint, options) {
  const cdpEndpoint = typeof endpoint === "string" ? endpoint : endpoint instanceof URL ? endpoint.toString() : endpointURLString(endpoint);
  const serverPromise = createServer({
    browser: "chromium",
    userDataDir: "/playwright/user-data",
    headless: true,
    cdpEndpoint,
    capabilities: ["core", "tabs", "pdf", "history", "wait", "files"],
    ...options
  });
  return class PlaywrightMcpAgent extends McpAgent {
    constructor() {
      super(...arguments);
      this.server = serverPromise;
    }
    async init() {
    }
  };
}

export { createMcpAgent };
